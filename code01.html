<!DOCTYPE html>
<html>
  <head>
    <title>Vinay GITHUB Website</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://fonts.googleapis.com/css?family=Roboto&display=swap"
      rel="stylesheet"
    />
    <style>
      /* ... (existing styles) ... */
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
    <script type="text/javascript">
      function loadFile() {
        // ... (existing loadFile function) ...
      }

      function getPlaces(query) {
        if (query.length < 3) return;

        var url = "https://secure.geonames.org/searchJSON?q=" + encodeURIComponent(query) + "&maxRows=10&username=vinaymangal";

        $.getJSON(url, function(data) {
          var suggestions = $("#suggestions");
          suggestions.empty();

          $.each(data.geonames, function(index, place) {
            var option = $("<div>").text(place.name + ", " + place.countryName).attr("data-value", JSON.stringify({
              name: place.name + ", " + place.countryName,
              latitude: place.lat,
              longitude: place.lng
            }));
            suggestions.append(option);
          });

          suggestions.show();
        });
      }

      function generateNakshatra() {
        var dob = document.getElementById("dob").value;
        var selectedPlace = JSON.parse($("#pob").attr("data-value"));
        var tob = document.getElementById("tob").value;

        // Extract the day, month, and year from the date of birth
        var dobParts = dob.split("-");
        var day = parseInt(dobParts[2]);
        var month = parseInt(dobParts[1]);
        var year = parseInt(dobParts[0]);

        // Extract the hour and minute from the time of birth
        var tobParts = tob.split(":");
        var hour = parseInt(tobParts[0]);
        var min = parseInt(tobParts[1]);

        // Prepare the API request data
        var requestData = {
          day: day,
          month: month,
          year: year,
          hour: hour,
          min: min,
          lat: selectedPlace.latitude,
          lon: selectedPlace.longitude,
          tzone: 5.5
        };

        // Make the API request using jQuery
        $.ajax({
          url: "https://json.astrologyapi.com/v1/astro_details",
          method: "POST",
          dataType: "json",
          headers: {
            "authorization": "Basic " + btoa("a1f574be-0a88-4f02-b28e-a5c888ebbb9a:WFambIbA92FcEk5Rlq3to7LDlXPxMZNLgl5gXGuZ"),
            "Content-Type": "application/json"
          },
          data: JSON.stringify(requestData),
          success: function(response) {
            console.log("API Response:", response);
            var nakshatra = response.moon_naks;
            document.getElementById("nakshatra").value = nakshatra;

            // Trigger the dropdown change event to display the corresponding solution
            var dropdown = document.getElementById("dropdown");
            dropdown.value = nakshatra;
            dropdown.dispatchEvent(new Event("change"));
          },
          error: function(xhr, status, error) {
            console.error("Error:", error);
          }
        });
      }

      $(document).ready(function() {
        loadFile();
        
        $("#pob").on("input", function() {
          var query = $(this).val();
          getPlaces(query);
        });

        $("#suggestions").on("click", "div", function() {
          var selectedPlace = JSON.parse($(this).attr("data-value"));
          $("#pob").val(selectedPlace.name).attr("data-value", JSON.stringify(selectedPlace));
          $("#suggestions").hide();
        });
      });
    </script>
  </head>
  <body>
    <div class="container">
      <h1>Nakshatra Properties</h1>
      <label for="dob">Date of Birth:</label>
      <input type="date" id="dob" name="dob" required>
      <label for="tob">Time of Birth:</label>
      <input type="time" id="tob" name="tob" required>
      <label for="pob">Place of Birth:</label>
      <input type="text" id="pob" name="pob" autocomplete="off" required>
      <div id="suggestions" style="display: none;"></div>
      <button onclick="generateNakshatra()">Generate Nakshatra</button>
      <label for="nakshatra">Generated Nakshatra:</label>
      <input type="text" id="nakshatra" name="nakshatra" readonly>
      <label for="dropdown">Select your Nakshatra:</label>
      <select id="dropdown" name="dropdown"></select>
      <label for="solution">Key traits of Nakshatra:</label>
      <textarea readonly id="solution" name="solution"></textarea>
      <p class="footer">
        If you want to know your Moon Nakshatra, check on this website:<br>
        <a href="https://www.prokerala.com/astrology/nakshatra-finder/">https://www.prokerala.com/astrology/nakshatra-finder/</a>
      </p>
    </div>
  </body>
</html>