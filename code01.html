<!DOCTYPE html>
<html>
  <head>
    <title>Vinay GITHUB Website</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://fonts.googleapis.com/css?family=Roboto&display=swap"
      rel="stylesheet"
    />
    <style>
      /* ... (existing styles) ... */
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
    <script type="text/javascript">
      function loadFile() {
        var url = "data.xlsx";
        var req = new XMLHttpRequest();
        req.open("GET", url, true);
        req.responseType = "arraybuffer";
        req.onload = function () {
          var data = new Uint8Array(req.response);
          var workbook = XLSX.read(data, { type: "array" });
          var sheetName = workbook.SheetNames[0];
          var worksheet = workbook.Sheets[sheetName];
          var options = [];
          var solutions = {};

          for (var i = 2; i < 1000; i++) {
            var optionCell = worksheet["B" + i];
            var solutionCell = worksheet["AU" + i];

            if (
              !optionCell ||
              !optionCell.v ||
              !solutionCell ||
              !solutionCell.v
            ) {
              break;
            }

            options.push(optionCell.v);
            solutions[optionCell.v] = solutionCell.v;
          }

          var dropdown = $("#dropdown");
          dropdown.empty();
          dropdown.append($("<option>").val("").text("--Please choose an option--"));

          $.each(options, function (index, option) {
            dropdown.append($("<option>").val(option).text(option));
          });

          dropdown.on("change", function () {
            var option = $(this).val();
            var solution = solutions[option];

            if (solution) {
              $("#solution").val(solution);
            }
          });
        };
        req.send();
      }

      function getPlaces(query) {
        if (query.length < 3) return;

        var url = "https://api.opencagedata.com/geocode/v1/json?q=" + encodeURIComponent(query) + "&key=2ab0c315e0c74bbb9e32684070bcfba9&limit=5";

        $.getJSON(url, function(data) {
          var suggestions = $("#suggestions");
          suggestions.empty();

          $.each(data.results, function(index, result) {
            var suggestion = $("<div>")
              .addClass("suggestion")
              .text(result.formatted)
              .attr("data-value", JSON.stringify({
                name: result.formatted,
                latitude: result.geometry.lat,
                longitude: result.geometry.lng
              }));
            suggestions.append(suggestion);
          });

          suggestions.show();
        });
      }

      function selectPlace(selectedPlace) {
        $("#pob").val(selectedPlace.name);
        $("#suggestions").hide();
      }

      function generateNakshatra() {
        var dob = $("#dob").val();
        var tob = $("#tob").val();
        var selectedPlace = JSON.parse($("#pob").attr("data-value"));

        if (!dob || !tob || !selectedPlace) {
          alert("Please fill in all the required fields.");
          return;
        }

        // Extract the day, month, and year from the date of birth
        var dobParts = dob.split("-");
        var day = parseInt(dobParts[2]);
        var month = parseInt(dobParts[1]);
        var year = parseInt(dobParts[0]);

        // Extract the hour and minute from the time of birth
        var tobParts = tob.split(":");
        var hour = parseInt(tobParts[0]);
        var min = parseInt(tobParts[1]);

        // Prepare the API request data
        var requestData = {
          day: day,
          month: month,
          year: year,
          hour: hour,
          min: min,
          lat: selectedPlace.latitude,
          lon: selectedPlace.longitude,
          tzone: 5.5
        };

        // Make the API request using jQuery
        $.ajax({
          url: "https://json.astrologyapi.com/v1/astro_details",
          method: "POST",
          dataType: "json",
          headers: {
            "authorization": "Basic " + btoa("a1f574be-0a88-4f02-b28e-a5c888ebbb9a:WFambIbA92FcEk5Rlq3to7LDlXPxMZNLgl5gXGuZ"),
            "Content-Type": "application/json"
          },
          data: JSON.stringify(requestData),
          success: function(response) {
            console.log("API Response:", response);
            var nakshatra = response.moon_naks;
            $("#nakshatra").val(nakshatra);
            $("#result").show();

            // Trigger the dropdown change event to display the corresponding solution
            $("#dropdown").val(nakshatra).trigger("change");
          },
          error: function(xhr, status, error) {
            console.error("Error:", error);
          }
        });
      }

      $(document).ready(function() {
        loadFile();

        $("#pob").on("input", function() {
          var query = $(this).val();
          getPlaces(query);
        });

        $("#suggestions").on("click", ".suggestion", function() {
          var selectedPlace = JSON.parse($(this).attr("data-value"));
          selectPlace(selectedPlace);
        });

        $("#generate").on("click", function() {
          generateNakshatra();
        });
      });
    </script>
  </head>
  <body>
    <div class="container">
      <h1>Nakshatra Properties</h1>
      <label for="dob">Date of Birth:</label>
      <input type="date" id="dob" name="dob" required>
      <label for="tob">Time of Birth:</label>
      <input type="time" id="tob" name="tob" required>
      <label for="pob">Place of Birth:</label>
      <input type="text" id="pob" name="pob" autocomplete="off" required>
      <div id="suggestions" style="display: none;"></div>
      <button id="generate">Generate Nakshatra</button>
      <div id="result" style="display: none;">
        <label for="nakshatra">Generated Nakshatra:</label>
        <input type="text" id="nakshatra" name="nakshatra" readonly>
        <label for="dropdown">Select your Nakshatra:</label>
        <select id="dropdown" name="dropdown"></select>
        <label for="solution">Key traits of Nakshatra:</label>
        <textarea id="solution" name="solution" readonly></textarea>
      </div>
    </div>
  </body>
</html>