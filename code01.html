<!DOCTYPE html>
<html>
  <head>
    <title>Vinay GITHUB Website</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://fonts.googleapis.com/css?family=Roboto&display=swap"
      rel="stylesheet"
    />
    <style>
      /* ... (existing styles) ... */
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
    <script type="text/javascript">
      function loadFile() {
        var url = "data.xlsx";
        var req = new XMLHttpRequest();
        req.open("GET", url, true);
        req.responseType = "arraybuffer";
        req.onload = function () {
          var data = new Uint8Array(req.response);
          var workbook = XLSX.read(data, { type: "array" });
          var sheetName = workbook.SheetNames[0];
          var worksheet = workbook.Sheets[sheetName];
          var options = [];
          var solutions = {};

          for (var i = 2; i < 1000; i++) {
            var optionCell = worksheet["B" + i];
            var solutionCell = worksheet["AU" + i];

            if (
              !optionCell ||
              !optionCell.v ||
              !solutionCell ||
              !solutionCell.v
            ) {
              break;
            }

            options.push(optionCell.v);
            solutions[optionCell.v] = solutionCell.v;
          }

          var dropdown = document.getElementById("dropdown");
          dropdown.innerHTML =
            '<option value="">--Please choose an option--</option>';

          for (var i = 0; i < options.length; i++) {
            var option = options[i];
            dropdown.innerHTML +=
              '<option value="' + option + '">' + option + "</option>";
          }

          dropdown.addEventListener("change", function () {
            var option = dropdown.value;
            var solution = solutions[option];

            if (solution) {
              document.getElementById("solution").value = solution;
            }
          });
        };
        req.send();
      }

      function getPlaces() {
        var url = "https://nominatim.openstreetmap.org/search?q=india&format=json&limit=50";

        $.getJSON(url, function(data) {
          var dropdown = $("#pob");
          $.each(data, function(index, place) {
            dropdown.append($("<option>").val(JSON.stringify({
              name: place.display_name,
              latitude: parseFloat(place.lat),
              longitude: parseFloat(place.lon)
            })).text(place.display_name));
          });
        });
      }

      function generateNakshatra() {
        var dob = document.getElementById("dob").value;
        var pobSelect = document.getElementById("pob");
        var selectedPlace = JSON.parse(pobSelect.value);
        var tob = document.getElementById("tob").value;

        // Extract the day, month, and year from the date of birth
        var dobParts = dob.split("-");
        var day = dobParts[2];
        var month = dobParts[1];
        var year = dobParts[0];

        // Extract the hour and minute from the time of birth
        var tobParts = tob.split(":");
        var hour = tobParts[0];
        var min = tobParts[1];

        // Prepare the API request data
        var requestData = {
          day: parseInt(day),
          month: parseInt(month),
          year: parseInt(year),
          hour: parseInt(hour),
          min: parseInt(min),
          lat: selectedPlace.latitude,
          lon: selectedPlace.longitude,
          tzone: 5.5
        };

        // Make the API request using jQuery
        $.ajax({
          url: "https://json.astrologyapi.com/v1/astro_details",
          method: "POST",
          dataType: "json",
          headers: {
            "authorization": "Basic " + btoa("a1f574be-0a88-4f02-b28e-a5c888ebbb9a:WFambIbA92FcEk5Rlq3to7LDlXPxMZNLgl5gXGuZ"),
            "Content-Type": "application/json"
          },
          data: JSON.stringify(requestData),
          success: function(response) {
            console.log("API Response:", response);
            var nakshatra = response.moon_naks;
            document.getElementById("nakshatra").value = nakshatra;

            // Trigger the dropdown change event to display the corresponding solution
            var dropdown = document.getElementById("dropdown");
            dropdown.value = nakshatra;
            dropdown.dispatchEvent(new Event("change"));
          },
          error: function(xhr, status, error) {
            console.error("Error:", error);
          }
        });
      }

      $(document).ready(function() {
        loadFile();
        getPlaces();
      });
    </script>
  </head>
  <body>
    <div class="container">
      <h1>Nakshatra Properties</h1>
      <label for="dob">Date of Birth:</label>
      <input type="date" id="dob" name="dob" required>
      <label for="tob">Time of Birth:</label>
      <input type="time" id="tob" name="tob" required>
      <label for="pob">Place of Birth:</label>
      <select id="pob" name="pob" required>
        <option value="">Select a place</option>
      </select>
      <button onclick="generateNakshatra()">Generate Nakshatra</button>
      <label for="nakshatra">Generated Nakshatra:</label>
      <input type="text" id="nakshatra" name="nakshatra" readonly>
      <label for="dropdown">Select your Nakshatra:</label>
      <select id="dropdown" name="dropdown"></select>
      <label for="solution">Key traits of Nakshatra:</label>
      <textarea readonly id="solution" name="solution"></textarea>
      <p class="footer">
        If you want to know your Moon Nakshatra, check on this website:<br>
        <a href="https://www.prokerala.com/astrology/nakshatra-finder/">https://www.prokerala.com/astrology/nakshatra-finder/</a>
      </p>
    </div>
  </body>
</html>